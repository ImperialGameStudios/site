import{r as l,u as P,M as w,a as v,j as r}from"./three-CECWILcm.js";import{g as y}from"./webgl-CfEKQtlZ.js";const S=({scale:e})=>{const s=y();return r.jsxs("group",{scale:[e,e,e],children:[r.jsxs("mesh",{position:[0,.3,0],children:[r.jsx("boxGeometry",{args:[2,.6,4]}),r.jsx("meshStandardMaterial",{color:"#e74c3c",metalness:s.enablePostProcessing?.8:.3,roughness:.2})]}),[-.8,.8].map((o,m)=>[1.2,-1.2].map((c,u)=>r.jsxs("mesh",{position:[o,-.2,c],rotation:[Math.PI/2,0,0],children:[r.jsx("cylinderGeometry",{args:[.3,.3,.2,8]}),r.jsx("meshStandardMaterial",{color:"#2c3e50",metalness:.1,roughness:.8})]},`wheel-${m}-${u}`)))]})},h=e=>{e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(s=>{M(s)}):M(e.material))},M=e=>{Object.keys(e).forEach(s=>{const o=e[s];o&&typeof o=="object"&&"minFilter"in o&&o.dispose()}),e.dispose()},O=({position:e=[0,0,0],rotation:s=[0,0,0],scale:o=1,animationSpeed:m=1})=>{const c=l.useRef(null),[u,g]=l.useState(!1),[b,p]=l.useState(!0),[d,j]=l.useState(null),n=y();let i=null;try{i=P("/src/assets/models/car.glb")}catch{console.warn("Car model not found, using fallback geometry")}const x=l.useCallback(t=>{const f=t.clone();return f.traverse(a=>{a instanceof w&&(a.castShadow=n.shadows,a.receiveShadow=n.shadows,a.material&&(a.material.envMapIntensity=n.enablePostProcessing?1:.5,!n.enablePostProcessing&&a.material.map&&console.log("Texture optimization needed for low-end device")),!n.enablePostProcessing&&a.geometry&&console.log("Geometry optimization for low-end device"))}),f},[n]);return v((t,f)=>{if(c.current){const a=n.enablePostProcessing?m:m*.5;if(c.current.rotation.y+=f*a*.5,n.enablePostProcessing){const z=Array.isArray(e)?e[1]:e.y;c.current.position.y=z+Math.sin(t.clock.elapsedTime*.5)*.1}}}),l.useEffect(()=>{if(i)try{const t=x(i.scene);j(t),p(!1),g(!1)}catch(t){console.error("Model optimization failed:",t),g(!0),p(!1)}else p(!1),g(!0)},[i,x]),l.useEffect(()=>()=>{d&&d.traverse(t=>{h(t)}),i&&i.scene.traverse(t=>{h(t)})},[d,i]),b?r.jsxs("mesh",{children:[r.jsx("boxGeometry",{args:[.1,.1,.1]}),r.jsx("meshStandardMaterial",{color:"#666",opacity:.5,transparent:!0})]}):r.jsx("group",{ref:c,position:Array.isArray(e)?e:[e.x,e.y,e.z],rotation:Array.isArray(s)?s:[s.x,s.y,s.z],scale:[o,o,o],children:!u&&d?r.jsx("primitive",{object:d,dispose:null}):r.jsx(S,{scale:1})})};if(typeof window<"u"&&y().enablePostProcessing)try{P.preload("/src/assets/models/car.glb")}catch(s){console.warn("Model preload failed:",s)}export{O as default};
