import{r,j as e,C as v}from"./three-CECWILcm.js";import{a as L,g as M,d as R}from"./webgl-CfEKQtlZ.js";const C=(h={})=>{const{targetFPS:t=30,memoryThreshold:o=100}=h,[s,m]=r.useState({fps:0,frameTime:0,isLowPerformance:!1}),[l,d]=r.useState(!1),u=r.useRef(0),p=r.useRef(performance.now()),c=r.useRef(void 0),n=r.useCallback(()=>{u.current++;const a=performance.now(),x=a-p.current;if(x>=1e3){const g=Math.round(u.current*1e3/x),j=x/u.current,b=performance.memory?.usedJSHeapSize;m(k=>({...k,fps:g,frameTime:j,isLowPerformance:g<t,memoryUsage:b?Math.round(b/1024/1024):void 0})),u.current=0,p.current=a}l&&(c.current=requestAnimationFrame(n))},[l,t]),i=r.useCallback(()=>{d(!0)},[]),f=r.useCallback(()=>{d(!1),c.current&&cancelAnimationFrame(c.current)},[]),y=r.useCallback(()=>{window.gc&&window.gc(),console.log("3D Memory cleanup requested")},[]),w=r.useCallback(()=>{const a=[];return s.fps<t&&(a.push("Reduce model complexity"),a.push("Lower texture resolution"),a.push("Disable shadows")),s.memoryUsage&&s.memoryUsage>o&&(a.push("Dispose unused textures"),a.push("Reduce texture size"),a.push("Use texture compression")),a},[s,t,o]);return r.useEffect(()=>(l&&(c.current=requestAnimationFrame(n)),()=>{c.current&&cancelAnimationFrame(c.current)}),[l,n]),r.useEffect(()=>(i(),f),[i,f]),{metrics:s,isMonitoring:l,startMonitoring:i,stopMonitoring:f,cleanupMemory:y,getOptimizationSuggestions:w()}};class S extends r.Component{retryCount=0;maxRetries=3;constructor(t){super(t),this.state={hasError:!1,errorType:"unknown",errorMessage:"",canRetry:!0}}static getDerivedStateFromError(t){let o="unknown",s=t.message;return t.message.includes("WebGL")?(o="webgl",s="WebGL context lost or not supported"):t.message.includes("memory")||t.message.includes("Memory")?(o="memory",s="Insufficient memory for 3D rendering"):(t.message.includes("model")||t.message.includes("GLTF"))&&(o="model",s="Failed to load 3D model"),{hasError:!0,errorType:o,errorMessage:s,canRetry:o!=="webgl"}}componentDidCatch(t,o){console.error("3D Error Boundary caught an error:",t,o);const s=L();console.error("WebGL Capabilities:",s),this.props.onError&&this.props.onError(t,o)}handleRetry=()=>{this.retryCount<this.maxRetries&&this.state.canRetry&&(this.retryCount++,this.setState({hasError:!1,errorType:"unknown",errorMessage:"",canRetry:!0}))};renderFallback(){const{errorType:t,errorMessage:o,canRetry:s}=this.state;return this.props.fallback?this.props.fallback:e.jsx("div",{className:"flex items-center justify-center w-full h-full bg-gradient-to-br from-gray-900 to-gray-800 p-8",children:e.jsxs("div",{className:"text-center text-white max-w-md",children:[e.jsxs("div",{className:"mb-6",children:[t==="webgl"&&e.jsx("svg",{className:"w-16 h-16 mx-auto mb-4 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})}),t==="memory"&&e.jsx("svg",{className:"w-16 h-16 mx-auto mb-4 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),t==="model"&&e.jsx("svg",{className:"w-16 h-16 mx-auto mb-4 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 4V2a1 1 0 011-1h8a1 1 0 011 1v2m0 0V1a1 1 0 011-1h2a1 1 0 011 1v18a1 1 0 01-1 1H4a1 1 0 01-1-1V4a1 1 0 011-1h2a1 1 0 011 1v3"})})]}),e.jsxs("h3",{className:"text-xl font-semibold mb-4",children:[t==="webgl"&&"3D Graphics Not Available",t==="memory"&&"Memory Limit Reached",t==="model"&&"Model Loading Failed",t==="unknown"&&"3D Rendering Error"]}),e.jsx("p",{className:"text-gray-300 mb-6",children:o}),t==="webgl"&&e.jsxs("div",{className:"text-sm text-gray-400 mb-4",children:[e.jsx("p",{children:"Your browser may not support WebGL or hardware acceleration is disabled."}),e.jsx("p",{children:"Try updating your browser or enabling hardware acceleration in settings."})]}),s&&this.retryCount<this.maxRetries&&e.jsxs("button",{onClick:this.handleRetry,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:["Retry (",this.maxRetries-this.retryCount," attempts left)"]}),(!s||this.retryCount>=this.maxRetries)&&e.jsx("p",{className:"text-sm text-gray-400",children:"The site will continue to work without 3D graphics."})]})})}render(){return this.state.hasError?this.renderFallback():this.props.children}}const E=({metrics:h})=>null,N=()=>e.jsx("div",{className:"flex items-center justify-center w-full h-full bg-gradient-to-br from-gray-900 to-gray-800",children:e.jsxs("div",{className:"text-white text-center p-8 max-w-md",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto mb-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"3D Graphics Unavailable"}),e.jsx("p",{className:"text-gray-300 mb-4",children:"Your browser doesn't support WebGL or 3D graphics are disabled."}),e.jsx("p",{className:"text-sm text-gray-400",children:"The site will continue to work with a simplified experience."})]})}),P=({children:h,className:t=""})=>{const[o,s]=r.useState(!0),[m,l]=r.useState(M()),{metrics:d,cleanupMemory:u,getOptimizationSuggestions:p}=C({targetFPS:30,memoryThreshold:150});r.useEffect(()=>{s(R())},[]),r.useEffect(()=>{d.isLowPerformance&&(console.log("Performance optimization suggestions:",p),l(i=>({...i,antialias:!1,shadows:!1,pixelRatio:1,maxLights:2})))},[d.isLowPerformance,p]),r.useEffect(()=>()=>{u()},[u]);const c=r.useMemo(()=>({camera:{position:[0,0,5],fov:75,near:.1,far:1e3},gl:{antialias:m.antialias,alpha:!0,powerPreference:"high-performance",stencil:!1,depth:!0},dpr:m.pixelRatio,performance:{min:.5,max:1,debounce:200},shadows:m.shadows,onCreated:({gl:n,camera:i})=>{n.physicallyCorrectLights=!0,n.outputEncoding=3001,n.toneMapping=1,n.toneMappingExposure=1,i.updateProjectionMatrix(),console.log("3D Scene initialized:",{renderer:n.capabilities,pixelRatio:n.getPixelRatio(),maxTextureSize:n.capabilities.maxTextureSize})}}),[m]);return o?e.jsxs("div",{className:`w-full h-full relative ${t}`,children:[e.jsx(S,{onError:(n,i)=>{console.error("3D Scene Error:",n,i)},children:e.jsx(v,{...c,children:e.jsx(r.Suspense,{fallback:null,children:h})})}),e.jsx(E,{metrics:d})]}):e.jsx("div",{className:`w-full h-full ${t}`,children:e.jsx(N,{})})};export{P as default};
